{% extends "base.html" %}

{% block content %}
<div class="admin-container">
    <input type="hidden" id="csrf_token" value="{{ authenticity_token }}">
    <div class="header-actions">
        <h1 class="page-title">Blocks for: {{ project_title }}</h1>
    </div>

    <div class="blocks-grid">
        <!-- Add New Block Cards -->
        <a href="/admin/projects/{{ project_id }}/blocks/new?type=Text" class="add-block-card">
            <span class="material-icons">description</span>
            <span>Add Text</span>
        </a>
        <a href="/admin/projects/{{ project_id }}/blocks/new?type=Gallery" class="add-block-card">
            <span class="material-icons">collections</span>
            <span>Add Gallery</span>
        </a>
        <a href="/admin/projects/{{ project_id }}/blocks/new?type=Video" class="add-block-card">
            <span class="material-icons">movie</span>
            <span>Add Video</span>
        </a>
        <a href="/admin/projects/{{ project_id }}/blocks/new?type=Audio" class="add-block-card">
            <span class="material-icons">audiotrack</span>
            <span>Add Audio</span>
        </a>
        <a href="/admin/projects/{{ project_id }}/blocks/new?type=File" class="add-block-card">
            <span class="material-icons">insert_drive_file</span>
            <span>Add File</span>
        </a>
    </div>

    <div id="blocks-list" class="blocks-list">
        {% for block in blocks %}
        <div class="block-item" data-id="{{ block.id }}">
            <div class="drag-handle material-icons">drag_indicator</div>
            <div class="block-info">
                <span class="block-type">{{ block.block_type }}</span>
                <span class="block-preview">
                    {% if block.block_type == "Text" %}
                    {{ block.content.0.as_text().unwrap_or("Text Content")|truncate(50) }}
                    {% else %}
                    {{ block.block_type }} Content
                    {% endif %}
                </span>
            </div>
            <div class="block-actions">
                <a href="/admin/blocks/{{ block.id }}" class="icon-btn" title="Edit">
                    <span class="material-icons">edit</span>
                </a>
                <form method="POST" action="/admin/blocks/delete/{{ block.id }}" class="inline-form confirm-delete">
                    <input type="hidden" name="authenticity_token" value="{{ authenticity_token }}">
                    <button type="submit" class="icon-btn delete" title="Delete">
                        <span class="material-icons">delete</span>
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="actions">
        <a href="/admin/dashboard" class="btn">Back to Dashboard</a>
        <button id="save-order-btn" class="btn" style="display: none;">Save Order</button>
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script src="/static/js/admin-blocks.js"></script>
{% endblock %}